<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>My Created Characters</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="profilePage">
    <h1>
        <span class="tab" id="myCharactersTab">My Characters</span>
        <span class="separator">|</span>
        <span class="tab" id="myFavoritesTab">My Favorites</span>
    </h1>
    <button onclick="window.location.href='index.html';" class="back-btn">Back</button>
    <div class="character-grid" id="characterGrid">Loading characters...</div>
  </div>

  <script type="module">
    import { populateGrid } from './characterGrid.js';

    async function loadCharacters(type) {
      try {
        const response = await fetch('https://chatcord-server.onrender.com/get-characters');
        const data = await response.json();

        // Get the current user's ID from localStorage
        const user = JSON.parse(localStorage.getItem('user'));
        const myUserId = user ? user.id : null;
        if (!myUserId) {
          document.getElementById('characterGrid').innerText = "User not logged in or user ID missing.";
          return;
        }

        let characterArray = (type === 'mine') 
          ? Object.entries(data).filter(([id, character]) => character.userID === myUserId) 
          : Object.entries(data).filter(([id, character]) => character.userID !== myUserId);

        populateGrid(characterArray, [], [], false);
      } catch (error) {
        console.error("Error fetching characters:", error);
        document.getElementById('characterGrid').innerText = "Failed to load characters.";
      }
    }

    // Wait for the DOM to load
    document.addEventListener('DOMContentLoaded', async () => {
      document.getElementById('myCharactersTab').addEventListener('click', () => loadCharacters('mine'));
      document.getElementById('myFavoritesTab').addEventListener('click', () => loadCharacters('favorites'));

      // Load 'My Characters' by default
      await loadCharacters('mine');
    });
  </script>
</body>
</html>
